<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily University Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #ffffff;
            color: #37352f;
            line-height: 1.5;
            padding: 20px;
            overflow-x: hidden;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 30px;
            min-height: calc(100vh - 40px);
        }

        .left-column {
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 280px;
            max-width: 320px;
        }

        /* Header Section */
        .header-section {
            text-align: center;
            margin-bottom: 25px;
        }

        .date-display {
            font-size: 18px;
            font-weight: 600;
            color: #37352f;
            margin-bottom: 8px;
        }

        .time-display {
            font-size: 48px;
            font-weight: 900;
            color: #37352f;
            font-family: ui-monospace, SFMono-Regular, 'SF Mono', Monaco, Inconsolata, 'Roboto Mono', monospace;
            margin-bottom: 20px;
            letter-spacing: -1px;
        }

        /* Progress Bar */
        .progress-section {
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .theme-toggle {
            background: #ffffff;
            border: 2px solid #c5c5c5;
            border-radius: 8px;
            width: 36px;
            height: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            flex-shrink: 0;
        }

        .theme-toggle:hover {
            border-color: #787774;
            transform: scale(1.05);
        }

        .brightness-icon {
            width: 16px;
            height: 16px;
        }

        .progress-container {
            position: relative;
            flex: 1;
            height: 25px;
            background: linear-gradient(90deg, #9b59b6, #3498db, #87ceeb, #3498db, #9b59b6);
            border-radius: 12px;
            overflow: hidden;
        }

        .progress-percent {
            font-size: 16px;
            font-weight: bold;
            color: #37352f;
            min-width: 45px;
            text-align: right;
        }

        .progress-passed {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #666, #888, #999, #888, #666);
            transition: width 0.5s ease;
            border-radius: 12px 0 0 12px;
        }

        .time-indicator {
            position: absolute;
            top: -2px;
            width: 4px;
            height: 29px;
            background: #f1c40f;
            border-radius: 2px;
            transition: left 0.5s ease;
            box-shadow: 0 0 8px rgba(241, 196, 15, 0.5);
            z-index: 2;
        }

        /* Schedule Section */
        .schedule-section {
            flex: 1;
            overflow: hidden;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #37352f;
            margin-bottom: 16px;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: 60px 1fr;
            background: #fafafa;
            border-radius: 12px;
            padding: 20px;
            height: 600px;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .time-column {
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e9e9e7;
            padding-right: 15px;
        }

        .time-slot {
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: ui-monospace, SFMono-Regular, 'SF Mono', Monaco, Inconsolata, 'Roboto Mono', monospace;
            font-size: 12px;
            color: #787774;
            font-weight: 500;
            position: relative;
        }

        .time-slot.hour {
            color: #37352f;
            font-weight: 600;
        }

        .time-slot.noon {
            border-top: 1px dotted #2383e2;
            padding-top: 2px;
        }

        .events-column {
            padding-left: 15px;
            position: relative;
        }

        .time-progress-line {
            position: absolute;
            left: -15px;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, rgba(255, 71, 87, 0.8), rgba(255, 71, 87, 0.4));
            z-index: 10;
            transition: top 0.5s ease;
            border-radius: 1px;
            pointer-events: none;
        }

        .events-row {
            min-height: 50px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            position: relative;
            padding: 5px 0;
            transition: background 0.2s ease;
        }

        .events-row.drag-over {
            background: rgba(35, 131, 226, 0.1);
            border-radius: 6px;
        }

        .event-block {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 500;
            cursor: move;
            transition: all 0.15s ease;
            position: relative;
            min-width: 100px;
            max-width: 200px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .event-block:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
            z-index: 5;
        }

        .event-block.dragging {
            opacity: 0.5;
            z-index: 1000;
        }

        .event-content {
            background: transparent;
            border: none;
            outline: none;
            font-size: 12px;
            font-weight: 500;
            width: 100%;
            color: #37352f;
            cursor: text;
        }

        .delete-btn {
            position: absolute;
            top: -6px;
            right: -6px;
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .event-block:hover .delete-btn {
            display: flex;
        }

        .add-event-btn {
            background: transparent;
            border: 1px dashed #c5c5c5;
            color: #787774;
            padding: 4px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.15s ease;
        }

        .add-event-btn:hover {
            border-color: #2383e2;
            color: #2383e2;
            background: rgba(35, 131, 226, 0.05);
        }

        /* Right Column Sections */
        .calendar-section, .category-section {
            background: #f7f6f3;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .section-header {
            font-size: 16px;
            font-weight: 600;
            color: #37352f;
            margin-bottom: 12px;
        }

        .sync-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .sync-btn {
            background: #2383e2;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            flex: 1;
            transition: all 0.15s ease;
        }

        .sync-btn:hover {
            background: #1e6bb8;
            transform: translateY(-1px);
        }

        .sync-status {
            font-size: 11px;
            color: #787774;
            margin-bottom: 12px;
            font-style: italic;
        }

        /* Mini Calendar */
        .calendar-header {
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 12px;
            color: #37352f;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #787774;
            padding: 4px 8px;
            transition: all 0.15s ease;
        }

        .nav-btn:hover {
            color: #37352f;
            transform: scale(1.2);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .calendar-day {
            text-align: center;
            padding: 6px 2px;
            font-size: 11px;
            color: #787774;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.15s ease;
        }

        .calendar-day.header {
            font-weight: 600;
            color: #37352f;
            font-size: 10px;
            cursor: default;
        }

        .calendar-day.current {
            background: #2383e2;
            color: white;
            font-weight: 600;
        }

        .calendar-day.selected {
            background: #ff9800;
            color: white;
            font-weight: 600;
        }

        .calendar-day.other-month {
            color: #c5c5c5;
        }

        .calendar-day:hover:not(.header):not(.other-month) {
            background: #e3f2fd;
            transform: scale(1.1);
        }

        /* Category Section */
        .category-list {
            flex: 1;
            margin-bottom: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            padding: 6px;
            border-radius: 6px;
            transition: background 0.15s ease;
        }

        .category-item:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .category-color {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s ease;
        }

        .category-color:hover {
            border-color: #37352f;
            transform: scale(1.1);
        }

        .category-color.selected {
            border-color: #2383e2;
            box-shadow: 0 0 0 2px rgba(35, 131, 226, 0.2);
        }

        .category-name {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            font-size: 12px;
            color: #37352f;
            padding: 2px 4px;
        }

        .category-name:focus {
            background: white;
            border-radius: 4px;
        }

        .category-delete {
            background: none;
            border: none;
            color: #ff4757;
            cursor: pointer;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.15s ease;
            padding: 2px 4px;
        }

        .category-item:hover .category-delete {
            opacity: 1;
        }

        .add-category-btn {
            background: transparent;
            border: 1px dashed #c5c5c5;
            color: #787774;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.15s ease;
        }

        .add-category-btn:hover {
            border-color: #2383e2;
            color: #2383e2;
            background: rgba(35, 131, 226, 0.05);
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
            padding: 8px 0;
        }

        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s ease;
        }

        .color-option:hover {
            border-color: #37352f;
            transform: scale(1.2);
        }

        /* Dark Mode */
        body.dark-mode {
            background: #1a1a1a;
            color: #e4e4e4;
        }

        .dark-mode .date-display,
        .dark-mode .time-display,
        .dark-mode .section-title,
        .dark-mode .section-header {
            color: #e4e4e4;
        }

        .dark-mode .schedule-grid {
            background: #2d2d2d;
        }

        .dark-mode .time-column {
            border-right-color: #404040;
        }

        .dark-mode .time-slot {
            color: #999;
        }

        .dark-mode .time-slot.hour {
            color: #c0c0c0;
        }

        .dark-mode .calendar-section,
        .dark-mode .category-section {
            background: #2d2d2d;
        }

        .dark-mode .calendar-day {
            color: #a0a0a0;
        }

        .dark-mode .calendar-day.header {
            color: #e4e4e4;
        }

        .dark-mode .calendar-day:hover:not(.header):not(.other-month) {
            background: #404040;
        }

        .dark-mode .category-name {
            color: #e4e4e4;
        }

        .dark-mode .theme-toggle {
            background: #2d2d2d;
            border-color: #606060;
        }

        .dark-mode .theme-toggle:hover {
            border-color: #a0a0a0;
        }

        .dark-mode .progress-percent {
            color: #e4e4e4;
        }

        .dark-mode .add-event-btn,
        .dark-mode .add-category-btn {
            border-color: #606060;
            color: #a0a0a0;
        }

        .dark-mode .add-event-btn:hover,
        .dark-mode .add-category-btn:hover {
            border-color: #2383e2;
            color: #2383e2;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .right-column {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                max-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .time-display {
                font-size: 36px;
            }
            
            .right-column {
                grid-template-columns: 1fr;
            }
            
            .schedule-grid {
                grid-template-columns: 50px 1fr;
                padding: 15px;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .dark-mode ::-webkit-scrollbar-track {
            background: #2d2d2d;
        }

        .dark-mode ::-webkit-scrollbar-thumb {
            background: #606060;
        }

        .dark-mode ::-webkit-scrollbar-thumb:hover {
            background: #808080;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="left-column">
            <div class="header-section">
                <div class="date-display" id="dateDisplay">Loading...</div>
                <div class="time-display" id="timeDisplay">00:00:00</div>
            </div>

            <div class="progress-section">
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
                    <svg class="brightness-icon" id="themeIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                </button>
                <div class="progress-container">
                    <div class="progress-passed" id="progressPassed"></div>
                    <div class="time-indicator" id="timeIndicator"></div>
                </div>
                <div class="progress-percent" id="progressPercent">0%</div>
            </div>

            <div class="schedule-section">
                <h2 class="section-title">Today's Schedule</h2>
                <div class="schedule-grid">
                    <div class="time-column" id="timeColumn"></div>
                    <div class="events-column" id="eventsColumn">
                        <div class="time-progress-line" id="timeProgressLine"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-column">
            <div class="calendar-section">
                <div class="section-header">Calendar</div>
                <div class="sync-buttons">
                    <button class="sync-btn" onclick="syncGoogleCalendar()">📅 Google</button>
                    <button class="sync-btn" onclick="syncOutlook()">📧 Outlook</button>
                </div>
                <div class="sync-status" id="syncStatus">Not connected</div>
                
                <div class="mini-calendar">
                    <div class="calendar-header">
                        <button class="nav-btn" onclick="previousMonth()">‹</button>
                        <span id="calendarMonth">Loading...</span>
                        <button class="nav-btn" onclick="nextMonth()">›</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>

            <div class="category-section">
                <div class="section-header">Event Categories</div>
                <div class="category-list" id="categoryList"></div>
                <button class="add-category-btn" onclick="addCategory()">+ Add Category</button>
                <div class="color-palette" id="colorPalette"></div>
            </div>
        </div>
    </div>

    <script>
        // State Management
        let currentDate = new Date();
        let selectedDate = new Date();
        let viewingMonth = new Date();
        let selectedCategoryForColor = null;
        let draggedElement = null;
        let isDarkMode = false;

        // Default Data
        let scheduleData = [
            { id: 1, time: "08:00", content: "Morning Routine", category: "personal" },
            { id: 2, time: "09:00", content: "Mathematics Lecture", category: "study" },
            { id: 3, time: "12:30", content: "Lunch Break", category: "food" },
            { id: 4, time: "14:00", content: "Physics Tutorial", category: "study" },
            { id: 5, time: "17:00", content: "Gym Session", category: "fitness" },
            { id: 6, time: "19:30", content: "Assignment Work", category: "study" }
        ];

        let categories = [
            { id: "personal", name: "Personal", color: "#fce4ec" },
            { id: "study", name: "Study", color: "#e3f2fd" },
            { id: "food", name: "Food", color: "#f8bbd9" },
            { id: "health", name: "Health", color: "#c5cae9" },
            { id: "fitness", name: "Fitness", color: "#90caf9" }
        ];

        const colorOptions = [
            "#fce4ec", "#f3e5f5", "#e8eaf6", "#e3f2fd",
            "#f8bbd9", "#e1bee7", "#c5cae9", "#bbdefb",
            "#f48fb1", "#ce93d8", "#9fa8da", "#90caf9",
            "#f06292", "#ba68c8", "#7986cb", "#64b5f6"
        ];

        let nextEventId = 7;
        let nextCategoryId = 6;

        // Data Persistence
        function saveData() {
            try {
                const data = {
                    scheduleData,
                    categories,
                    nextEventId,
                    nextCategoryId,
                    isDarkMode,
                    selectedDate: selectedDate.toISOString()
                };
                sessionStorage.setItem('plannerData', JSON.stringify(data));
            } catch (e) {
                console.log('Storage not available');
            }
        }

        function loadData() {
            try {
                const saved = sessionStorage.getItem('plannerData');
                if (saved) {
                    const data = JSON.parse(saved);
                    scheduleData = data.scheduleData || scheduleData;
                    categories = data.categories || categories;
                    nextEventId = data.nextEventId || nextEventId;
                    nextCategoryId = data.nextCategoryId || nextCategoryId;
                    isDarkMode = data.isDarkMode || false;
                    if (data.selectedDate) {
                        selectedDate = new Date(data.selectedDate);
                        viewingMonth = new Date(data.selectedDate);
                    }
                }
            } catch (e) {
                console.log('Could not load saved data');
            }
        }

        // Theme Management
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            
            const icon = document.getElementById('themeIcon');
            if (isDarkMode) {
                icon.innerHTML = `
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                `;
            } else {
                icon.innerHTML = `
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                `;
            }
            saveData();
        }

        // Time and Date Functions
        function updateTime() {
            const now = new Date();
            
            // Update time display
            document.getElementById('timeDisplay').textContent = now.toTimeString().slice(0, 8);
            
            // Update date display
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('dateDisplay').textContent = selectedDate.toLocaleDateString('en-US', options);
            
            // Update progress bar
            const totalMinutes = 24 * 60;
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            const percentage = (currentMinutes / totalMinutes) * 100;
            
            document.getElementById('progressPassed').style.width = `${percentage}%`;
            document.getElementById('timeIndicator').style.left = `${percentage}%`;
            document.getElementById('progressPercent').textContent = `${Math.round(percentage)}%`;
            
            // Update time progress line in schedule
            updateTimeProgressLine(percentage);
        }

        function updateTimeProgressLine(percentage) {
            const eventsColumn = document.getElementById('eventsColumn');
            const progressLine = document.getElementById('timeProgressLine');
            if (eventsColumn && progressLine) {
                const columnHeight = eventsColumn.scrollHeight;
                const linePosition = (percentage / 100) * columnHeight;
                progressLine.style.top = `${linePosition}px`;
            }
        }

        // Schedule Functions
        function createTimeSlots() {
            const timeColumn = document.getElementById('timeColumn');
            const eventsColumn = document.getElementById('eventsColumn');
            
            timeColumn.innerHTML = '';
            eventsColumn.innerHTML = '<div class="time-progress-line" id="timeProgressLine"></div>';
            
            for (let hour = 0; hour < 24; hour++) {
                // Create time slot
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                if (hour % 1 === 0) timeSlot.classList.add('hour');
                if (hour === 12) timeSlot.classList.add('noon');
                
                const timeString = `${String(hour).padStart(2, '0')}:00`;
                timeSlot.textContent = timeString;
                timeColumn.appendChild(timeSlot);
                
                // Create events row
                const eventsRow = document.createElement('div');
                eventsRow.className = 'events-row';
                eventsRow.dataset.hour = hour;
                
                // Add events for this hour
                const hourEvents = scheduleData.filter(event => {
                    const eventHour = parseInt(event.time.split(':')[0]);
                    return eventHour === hour;
                });
                
                hourEvents.forEach(event => {
                    eventsRow.appendChild(createEventBlock(event));
                });
                
                // Add button
                const addBtn = document.createElement('button');
                addBtn.className = 'add-event-btn';
                addBtn.textContent = '+';
                addBtn.onclick = () => addNewEvent(`${String(hour).padStart(2, '0')}:00`);
                eventsRow.appendChild(addBtn);
                
                // Drag and drop listeners
                eventsRow.addEventListener('dragover', handleDragOver);
                eventsRow.addEventListener('drop', handleDrop);
                eventsRow.addEventListener('dragleave', handleDragLeave);
                
                eventsColumn.appendChild(eventsRow);
            }
            
            updateTime();
        }

        function createEventBlock(event) {
            const category = categories.find(c => c.id === event.category);
            const eventBlock = document.createElement('div');
            eventBlock.className = 'event-block';
            eventBlock.id = `event-${event.id}`;
            eventBlock.draggable = true;
            eventBlock.style.backgroundColor = category ? category.color : '#e3f2fd';
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'event-content';
            input.value = event.content;
            input.onchange = (e) => updateEventContent(event.id, e.target.value);
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.textContent = '×';
            deleteBtn.onclick = () => deleteEvent(event.id);
            
            eventBlock.appendChild(input);
            eventBlock.appendChild(deleteBtn);
            
            // Drag events
            eventBlock.addEventListener('dragstart', handleDragStart);
            eventBlock.addEventListener('dragend', handleDragEnd);
            
            return eventBlock;
        }

        function addNewEvent(time) {
            const newEvent = {
                id: nextEventId++,
                time: time,
                content: "New Event",
                category: categories[0]?.id || "personal"
            };
            scheduleData.push(newEvent);
            saveData();
            createTimeSlots();
        }

        function deleteEvent(eventId) {
            scheduleData = scheduleData.filter(e => e.id !== eventId);
            saveData();
            createTimeSlots();
        }

        function updateEventContent(eventId, newContent) {
            const event = scheduleData.find(e => e.id === eventId);
            if (event) {
                event.content = newContent;
                saveData();
            }
        }

        // Drag and Drop
        function handleDragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.innerHTML);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.drag-over').forEach(el => {
                el.classList.remove('drag-over');
            });
            draggedElement = null;
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            e.currentTarget.classList.add('drag-over');
            return false;
        }

        function handleDragLeave(e) {
            if (e.currentTarget.contains(e.relatedTarget)) return;
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            e.preventDefault();
            
            e.currentTarget.classList.remove('drag-over');
            
            if (!draggedElement) return;
            
            const eventId = parseInt(draggedElement.id.split('-')[1]);
            const newHour = parseInt(e.currentTarget.dataset.hour);
            const newTime = `${String(newHour).padStart(2, '0')}:00`;
            
            const event = scheduleData.find(ev => ev.id === eventId);
            if (event) {
                event.time = newTime;
                saveData();
                createTimeSlots();
            }
            
            return false;
        }

        // Calendar Functions
        function createMiniCalendar() {
            const year = viewingMonth.getFullYear();
            const month = viewingMonth.getMonth();
            
            const monthNames = ["January", "February", "March", "April", "May", "June",
                              "July", "August", "September", "October", "November", "December"];
            
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            let calendarHTML = '';
            
            // Day headers
            ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'].forEach(day => {
                calendarHTML += `<div class="calendar-day header">${day}</div>`;
            });
            
            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                calendarHTML += `<div class="calendar-day other-month">${daysInPrevMonth - i}</div>`;
            }
            
            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const isToday = date.toDateString() === currentDate.toDateString();
                const isSelected = date.toDateString() === selectedDate.toDateString();
                
                let classes = 'calendar-day';
                if (isToday) classes += ' current';
                if (isSelected && !isToday) classes += ' selected';
                
                calendarHTML += `<div class="${classes}" onclick="selectDate(${year}, ${month}, ${day})">${day}</div>`;
            }
            
            // Next month days
            const remainingDays = 42 - (firstDay + daysInMonth);
            for (let day = 1; day <= remainingDays; day++) {
                calendarHTML += `<div class="calendar-day other-month">${day}</div>`;
            }
            
            document.getElementById('calendarGrid').innerHTML = calendarHTML;
        }

        function selectDate(year, month, day) {
            selectedDate = new Date(year, month, day);
            saveData();
            createMiniCalendar();
            updateTime();
        }

        function previousMonth() {
            viewingMonth.setMonth(viewingMonth.getMonth() - 1);
            createMiniCalendar();
        }

        function nextMonth() {
            viewingMonth.setMonth(viewingMonth.getMonth() + 1);
            createMiniCalendar();
        }

        // Category Functions
        function createCategoryList() {
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = '';
            
            categories.forEach(category => {
                const item = document.createElement('div');
                item.className = 'category-item';
                
                const color = document.createElement('div');
                color.className = 'category-color';
                if (selectedCategoryForColor === category.id) {
                    color.classList.add('selected');
                }
                color.style.backgroundColor = category.color;
                color.onclick = () => selectCategoryForColor(category.id);
                
                const name = document.createElement('input');
                name.type = 'text';
                name.className = 'category-name';
                name.value = category.name;
                name.onchange = (e) => updateCategoryName(category.id, e.target.value);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'category-delete';
                deleteBtn.textContent = '×';
                deleteBtn.onclick = () => deleteCategory(category.id);
                
                item.appendChild(color);
                item.appendChild(name);
                item.appendChild(deleteBtn);
                categoryList.appendChild(item);
            });
        }

        function createColorPalette() {
            const palette = document.getElementById('colorPalette');
            palette.innerHTML = '';
            
            colorOptions.forEach(color => {
                const option = document.createElement('div');
                option.className = 'color-option';
                option.style.backgroundColor = color;
                option.onclick = () => selectColor(color);
                palette.appendChild(option);
            });
        }

        function addCategory() {
            const newCategory = {
                id: `category-${nextCategoryId++}`,
                name: "New Category",
                color: colorOptions[Math.floor(Math.random() * colorOptions.length)]
            };
            categories.push(newCategory);
            saveData();
            createCategoryList();
        }

        function deleteCategory(categoryId) {
            if (categories.length <= 1) {
                alert('You must have at least one category');
                return;
            }
            categories = categories.filter(c => c.id !== categoryId);
            saveData();
            createCategoryList();
            createTimeSlots();
        }

        function updateCategoryName(categoryId, newName) {
            const category = categories.find(c => c.id === categoryId);
            if (category) {
                category.name = newName;
                saveData();
            }
        }

        function selectCategoryForColor(categoryId) {
            selectedCategoryForColor = categoryId;
            createCategoryList();
        }

        function selectColor(color) {
            if (selectedCategoryForColor) {
                const category = categories.find(c => c.id === selectedCategoryForColor);
                if (category) {
                    category.color = color;
                    saveData();
                    createCategoryList();
                    createTimeSlots();
                }
            }
        }

        // Sync Functions
        function syncGoogleCalendar() {
            const status = document.getElementById('syncStatus');
            status.textContent = 'Connecting to Google...';
            setTimeout(() => {
                status.textContent = 'Google Calendar connected ✓';
                status.style.color = '#22c55e';
            }, 1500);
        }

        function syncOutlook() {
            const status = document.getElementById('syncStatus');
            status.textContent = 'Connecting to Outlook...';
            setTimeout(() => {
                status.textContent = 'Outlook connected ✓';
                status.style.color = '#22c55e';
            }, 1500);
        }

        // Initialize Application
        function init() {
            loadData();
            
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                const icon = document.getElementById('themeIcon');
                icon.innerHTML = `<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>`;
            }
            
            createTimeSlots();
            createMiniCalendar();
            createCategoryList();
            createColorPalette();
            updateTime();
            
            // Update time every second
            setInterval(updateTime, 1000);
            
            // Auto-save every 30 seconds
            setInterval(saveData, 30000);
        }

        // Start the application
        init();
    </script>
</body>
</html>
